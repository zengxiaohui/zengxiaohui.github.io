<!DOCTYPE html>
<!-- saved from url=(0034)http://www.imooc.com/article/14592 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>
绝对干货-Redis集群的优化_慕课手记
</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
<meta name="renderer" content="webkit">
<meta property="qc:admins" content="77103107776157736375">
<meta property="wb:webmaster" content="c4f857219bfae3cb">
<meta http-equiv="Access-Control-Allow-Origin" content="*">
<meta http-equiv="Cache-Control" content="no-transform ">
<meta http-equiv="Content-Security-Policy" content="script-src &#39;self&#39; &#39;unsafe-inline&#39; &#39;unsafe-eval&#39; *.imooc.com *.mukewang.com *.baidu.com *.sina.com.cn *.bootcss.com">



<meta name="Description" content="1.安装Redis3.0 yum -y install cpp binutils glibc glibc-kernheaders glibc-common glibc-devel ">








<link rel="stylesheet" href="./绝对干货-Redis集群的优化_慕课手记_files/moco.min.css" type="text/css">

<script src="./绝对干货-Redis集群的优化_慕课手记_files/push.js.下载"></script><script type="text/javascript" async="" src="./绝对干货-Redis集群的优化_慕课手记_files/rt.js.下载"></script><script type="text/javascript">

eval(function(p,a,c,k,e,d){e=function(c){return(c<a?"":e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)d[e(c)]=k[c]||e(c);k=[function(e){return d[e]}];e=function(){return'\\w+'};c=1;};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p;}('!4(){3 6=a;3 l=4(){3 b,e=9 y("(^| )"+"c=([^;]*)(;|$)");j(b=h.g.z(e)){k w(b[2])}x{k a}};3 8=4(t){3 f=l();3 7=9 o();7.A(7.d()+B*i*i*r);h.g="c="+t+";s="+7.M()+";N=/;L=O.m";j(t&&t!=f){Q.P.G()}};3 5=9 E();5.H=4(){K(6);6=a;8(0)};5.J=4(){8(1)};6=I(4(){5.n="";8(1)},F);5.n=\'R://p.u.m/p/v/q/D.C?t=\'+9 o().d()}()',54,54,'|||var|function|imgobj|timer|exp|setcookie|new|null|arr|IMCDNS|getTime|reg|_0|cookie|document|60|if|return|getcookie|com|src|Date|static|common|1000|expires||mukewang|img|unescape|else|RegExp|match|setTime|24|png|logo|Image|3000|reload|onload|setTimeout|onerror|clearTimeout|domain|toGMTString|path|imooc|location|window|http'.split('|'),0,{}))

</script>


<script type="text/javascript">

var OP_CONFIG={"module":"article","page":"details"};
var isLogin = 0;
var is_choice = "";
var seajsTimestamp="v=201704261343";
var _msg_unread = 0; 
var _not_unread = 0; 
var _cart_num = 0;
</script>





<script>
var pageInfo = {
    id: "14592",
    praiseNum:"6"
}
var user = {
    uid : "",
    img : "",
    nickname : ""
}
var authorUid = {
    uid : '2533881'
}
</script>

<link rel="stylesheet" href="./绝对干货-Redis集群的优化_慕课手记_files/saved_resource" type="text/css">
<script charset="utf-8" async="" src="./绝对干货-Redis集群的优化_慕课手记_files/jquery.js.下载"></script><script charset="utf-8" async="" src="./绝对干货-Redis集群的优化_慕课手记_files/seajs-text.js.下载"></script><script charset="utf-8" async="" src="./绝对干货-Redis集群的优化_慕课手记_files/common.js.下载"></script><script charset="utf-8" async="" src="./绝对干货-Redis集群的优化_慕课手记_files/string.js.下载"></script><script charset="utf-8" async="" src="./绝对干货-Redis集群的优化_慕课手记_files/userinfo.js.下载"></script><script charset="utf-8" async="" src="./绝对干货-Redis集群的优化_慕课手记_files/cart.js.下载"></script><script charset="utf-8" async="" src="./绝对干货-Redis集群的优化_慕课手记_files/cookie.js.下载"></script><script charset="utf-8" async="" src="./绝对干货-Redis集群的优化_慕课手记_files/suggest.js.下载"></script><script charset="utf-8" async="" src="./绝对干货-Redis集群的优化_慕课手记_files/store.js.下载"></script><script charset="utf-8" async="" src="./绝对干货-Redis集群的优化_慕课手记_files/json.js.下载"></script><script charset="utf-8" async="" src="./绝对干货-Redis集群的优化_慕课手记_files/im.js.下载"></script><script charset="utf-8" async="" src="./绝对干货-Redis集群的优化_慕课手记_files/details.js.下载"></script><script charset="utf-8" async="" src="./绝对干货-Redis集群的优化_慕课手记_files/socket.io.min.js.下载"></script><script charset="utf-8" async="" src="./绝对干货-Redis集群的优化_慕课手记_files/prettify.js.下载"></script><link charset="utf-8" rel="stylesheet" href="./绝对干货-Redis集群的优化_慕课手记_files/prettify.css"><script charset="utf-8" async="" src="./绝对干货-Redis集群的优化_慕课手记_files/ueditor.parse.js.下载"></script><script charset="utf-8" async="" src="./绝对干货-Redis集群的优化_慕课手记_files/layer.min.js.下载"></script><link charset="utf-8" rel="stylesheet" href="./绝对干货-Redis集群的优化_慕课手记_files/layer.css"><link charset="utf-8" rel="stylesheet" href="./绝对干货-Redis集群的优化_慕课手记_files/ueditor.css"><script charset="utf-8" async="" src="./绝对干货-Redis集群的优化_慕课手记_files/addCopy.js.下载"></script><script charset="utf-8" async="" src="./绝对干货-Redis集群的优化_慕课手记_files/imgPreview.js.下载"></script><script charset="utf-8" async="" src="./绝对干货-Redis集群的优化_慕课手记_files/praise.js.下载"></script><script charset="utf-8" async="" src="./绝对干货-Redis集群的优化_慕课手记_files/verify-code.js.下载"></script><script charset="utf-8" async="" src="./绝对干货-Redis集群的优化_慕课手记_files/moco.min.js.下载"></script><script charset="utf-8" async="" src="./绝对干货-Redis集群的优化_慕课手记_files/mo.min.js.下载"></script><script src="./绝对干货-Redis集群的优化_慕课手记_files/share.js.下载"></script><link rel="stylesheet" href="./绝对干货-Redis集群的优化_慕课手记_files/share_style0_16.css"></head>
<body>

<div id="header">
    <div class="page-container" id="nav">
        <div id="logo" class="logo"><a href="http://www.imooc.com/" target="_self" class="hide-text" title="首页">慕课网</a></div>


        <button type="button" class="navbar-toggle visible-xs-block js-show-menu">
            <i class="icon-menu"></i>
        </button>
        <ul class="nav-item">
                        <li class="set-btn visible-xs-block"><a href="http://www.imooc.com/user/newlogin" target="_self">登录</a> / <a href="http://www.imooc.com/user/newsignup" target="_self">注册</a></li>
                        
            <li>
                <a href="http://www.imooc.com/course/list" target="_self">课程</a>
            </li>
            <li><a href="http://class.imooc.com/" class="program-nav " target="_self">职业路径<i class="icn-new"></i></a></li>
            <li>
                <a href="http://coding.imooc.com/" target="_self">实战</a>
            </li>
            <li><a href="http://www.imooc.com/wenda" target="_self">猿问</a></li>
            <li><a href="http://www.imooc.com/article" class="active" target="_self">手记</a></li>
            
        </ul>
                <div id="login-area">
            <ul class="header-unlogin clearfix">
                <li class="shop-cart" id="shop-cart">
                    <a href="http://order.imooc.com/pay/cart" class="shop-cart-icon" target="_blank">
                        <span class="icon-shopping-cart js-endcart"></span>
                        <span class="shopping_icon js-cart-num" data-ordernum="0" data-cartnum="0" style="display: none">0</span>
                        <span>购物车</span>
                    </a>
                    <div class="my-cart" id="js-my-cart"><div class="cart-title-box clearfix">                                        <h2 class="l">我的购物车</h2>                                        <h5 class="r">已加入<span class="js-incart-num">0</span>门课程</h5>                                    </div>                                    <div class="cart-wrap">                                        <div class="clear-cart">                                            <span class="cartIcon icon-shopping-cart"></span>                                            <h3>购物车里空空如也</h3>                                            <div class="text">快去这里选购你中意的课程</div>                                            <p><a class="go-link" href="http://coding.imooc.com/" target="_blank">实战课程</a></p>                                            <p><a class="go-link" href="http://www.imooc.com/course/program" target="_blank">职业路径</a></p>                                        </div>                                    </div>                                    <div class="more-box clearfix">                                        <div class="l show-box">                                            <span class="text"><a href="http://order.imooc.com/myorder" target="_blank">我的订单中心</a></span>                                        </div>                                        <a href="http://order.imooc.com/pay/cart" target="_blank" class="r moco-btn moco-btn-red go-cart">去购物车</a>                                    </div></div>
                </li>
                <li class="header-signin">
                    <a href="http://www.imooc.com/article/14592#" id="js-signin-btn">登录</a>
                </li>
                <li class="header-signup">
                    <a href="http://www.imooc.com/article/14592#" id="js-signup-btn">注册</a>
                </li>
            </ul>
        </div>
                <div class="search-warp clearfix" style="min-width: 32px; height: 60px;">
                            <div class="pa searchTags">
                                    <a href="http://class.imooc.com/sc/20" target="_blank">前端小白</a>
                                    <a href="http://class.imooc.com/sc/22" target="_blank">PHP入门</a>
                                </div>
            
            <div class="search-area" data-search="top-banner">
                <input class="search-input" data-suggest-trigger="suggest-trigger" type="text" autocomplete="off">
                <input type="hidden" class="btn_search" data-search-btn="search-btn">
                <ul class="search-area-result" data-suggest-result="suggest-result">
                </ul>
            </div>
            <div class="showhide-search" data-show="no"><i class="icon-search"></i></div>
        </div>
    </div>
</div>

<div class="bindHintBox js-bindHintBox hide">
    <div class="pr">
        为了账号安全，请及时绑定邮箱和手机<a href="http://www.imooc.com/user/setbindsns" class="ml20 color-red" target="_blank">立即绑定</a>
        <button class="closeBindHint js-closeBindHint" type="button"></button>
        <div class="arrow"> </div>
    </div>
</div>


<script>
var isLogin=0
</script>
<div class="opus-wrap clearfix">

<div class="detail-left l">
    <!-- 面包屑 -->
    <div class="detail-path">
        <a href="http://www.imooc.com/article">手记</a> \
        <span>绝对干货-Redis集群的优化</span>
    </div>
    <!-- 面包屑end -->
    <!-- 手记详情 -->
    <div class="detail-content-wrap">
        <h1 class="detail-title">
        绝对干货-Redis集群的优化
                </h1>
        <div class="dc-addon clearfix">
            <div class="dc-profile clearfix">
                <span class="spacer l">2016-11-17 01:05:35</span>
                <span class="spacer l spacer-2">1613浏览</span>
                <a class="spacer l" href="http://www.imooc.com/article/14592#comment">0评论</a>
                            </div>
        </div>

        <div class="detail-content ">
            <p>1.安装Redis3.0<br>
yum -y install cpp binutils glibc glibc-kernheaders glibc-common glibc-devel gcc make gcc-c++ libstdc++-devel tcl</p>
<p>mkdir -p /usr/local/src/redis<br>
cd /usr/local/src/redis<br>
wget <a href="http://download.redis.io/releases/redis-3.0.2.tar.gz" target="_blank" rel="nofollow">http://download.redis.io/releases/redis-3.0.2.tar.gz</a>  或者 rz 上传<br>
tar -xvf redis-3.0.2.tar.gz<br>
cd redis-3.0.2<br>
make<br>
make test #这个就不要执行了，需要很长时间<br>
make install</p>
<p>cp redis.conf /etc/<br>
vi /etc/redis.conf</p>
<div class="anchor-list"> <a name="parent_1" class="lemma-anchor para-title"></a></div> <strong style="display:block;font-size:25px;padding-bottom:8px">修改如下，默认为no</strong>
<p>daemonize yes</p>
<div class="anchor-list"> <a name="parent_2" class="lemma-anchor para-title"></a></div> <strong style="display:block;font-size:25px;padding-bottom:8px">启动</strong>
<p>redis-server /etc/redis.conf</p>
<div class="anchor-list"> <a name="parent_3" class="lemma-anchor para-title"></a></div> <strong style="display:block;font-size:25px;padding-bottom:8px">测试</strong>
<p>redis-cli</p>
<p>2.主从复制（读写分离）<br>
主从复制的好处有2点：<br>
1、避免redis单点故障<br>
2、构建读写分离架构，满足读多写少的应用场景<br>
2.1.主从架构</p>
<p>2.1.1.启动实例<br>
创建6379、6380、6381目录，分别将安装目录下的redis.conf拷贝到这三个目录下。</p>
<p>分别进入这三个目录，分别修改配置文件，将端口分别设置为：6379（Master）、6380（Slave）、6381（Slave）。同时要设置pidfile文件为不同的路径。</p>
<p>分别启动三个redis实例：</p>
<p>2.1.2.设置主从<br>
在redis中设置主从有2种方式：</p>
<p>1、在redis.conf中设置slaveof<br>
a)slaveof &lt;masterip&gt; &lt;masterport&gt;<br>
2、使用redis-cli客户端连接到redis服务，执行slaveof命令<br>
a)slaveof &lt;masterip&gt; &lt;masterport&gt;</p>
<p>第二种方式在重启后将失去主从复制关系。</p>
<p>查看主从信息：INFO replication</p>
<p>主：</p>
<p>role：角色<br>
connected_slaves：从库数量<br>
slave0：从库信息</p>
<p>从：</p>
<p>2.1.3.测试<br>
在主库写入数据：</p>
<p>在从库读取数据：</p>
<p>2.2.主从从架构</p>
<p>2.2.1.启动实例</p>
<p>设置主从：</p>
<p>设置从从：</p>
<p>2.2.2.测试<br>
在主库设置数据：</p>
<p>在6380获取数据：</p>
<p>在6381获取数据：</p>
<p>2.3.从库只读<br>
默认情况下redis数据库充当slave角色时是只读的不能进行写操作。</p>
<p>可以在配置文件中开启非只读：slave-read-only no<br>
2.4.复制的过程原理<br>
1、当从库和主库建立MS关系后，会向主数据库发送SYNC命令；<br>
2、主库接收到SYNC命令后会开始在后台保存快照（RDB持久化过程），并将期间接收到的写命令缓存起来；<br>
3、当快照完成后，主Redis会将快照文件和所有缓存的写命令发送给从Redis；<br>
4、从Redis接收到后，会载入快照文件并且执行收到的缓存的命令；<br>
5、之后，主Redis每当接收到写命令时就会将命令发送从Redis，从而保证数据的一致；<br>
2.5.无磁盘复制<br>
通过前面的复制过程我们了解到，主库接收到SYNC的命令时会执行RDB过程，即使在配置文件中禁用RDB持久化也会生成，那么如果主库所在的服务器磁盘IO性能较差，那么这个复制过程就会出现瓶颈，庆幸的是，Redis在2.8.18版本开始实现了无磁盘复制功能（不过该功能还是处于试验阶段）。</p>
<p>原理：<br>
Redis在与从数据库进行复制初始化时将不会将快照存储到磁盘，而是直接通过网络发送给从数据库，避免了IO性能差问题。</p>
<p>开启无磁盘复制：repl-diskless-sync yes</p>
<p>2.6.复制架构中出现宕机情况，怎么办？<br>
如果在主从复制架构中出现宕机的情况，需要分情况看：<br>
1、从Redis宕机<br>
a)这个相对而言比较简单，在Redis中从库重新启动后会自动加入到主从架构中，自动完成同步数据；<br>
b)问题？ 如果从库在断开期间，主库的变化不大，从库再次启动后，主库依然会将所有的数据做RDB操作吗？还是增量更新？（从库有做持久化的前提下）<br>
i.不会的，因为在Redis2.8版本后就实现了，主从断线后恢复的情况下实现增量复制。<br>
2、主Redis宕机<br>
a)这个相对而言就会复杂一些，需要以下2步才能完成<br>
i.第一步，在从数据库中执行SLAVEOF NO ONE命令，断开主从关系并且提升为主库继续服务；<br>
ii.第二步，将主库重新启动后，执行SLAVEOF命令，将其设置为其他库的从库，这时数据就能更新回来；<br>
b)这个手动完成恢复的过程其实是比较麻烦的并且容易出错，有没有好办法解决呢？当前有的，Redis提高的哨兵（sentinel）的功能。</p>
<p>3.哨兵（sentinel）<br>
3.1.什么是哨兵<br>
顾名思义，哨兵的作用就是对Redis的系统的运行情况的监控，它是一个独立进程。它的功能有2个：</p>
<p>1、监控主数据库和从数据库是否运行正常；<br>
2、主数据出现故障后自动将从数据库转化为主数据库；<br>
3.2.原理<br>
单个哨兵的架构：</p>
<p>多个哨兵的架构：</p>
<p>多个哨兵，不仅同时监控主从数据库，而且哨兵之间互为监控。<br>
3.3.环境<br>
当前处于一主多从的环境中：</p>
<p>3.4.配置哨兵<br>
启动哨兵进程首先需要创建哨兵配置文件：</p>
<p>vim sentinel.conf<br>
输入内容：<br>
sentinel monitor taotaoMaster 127.0.0.1 6379 1</p>
<p>说明：<br>
taotaoMaster：监控主数据的名称，自定义即可，可以使用大小写字母和“.-_”符号<br>
127.0.0.1：监控的主数据库的IP<br>
6379：监控的主数据库的端口<br>
1：最低通过票数</p>
<p>启动哨兵进程：<br>
redis-sentinel ./sentinel.conf</p>
<p>由上图可以看到：<br>
1、哨兵已经启动，它的id为9059917216012421e8e89a4aa02f15b75346d2b7<br>
2、为master数据库添加了一个监控<br>
3、发现了2个slave（由此可以看出，哨兵无需配置slave，只需要指定master，哨兵会自动发现slave）<br>
3.5.从数据库宕机</p>
<p>kill掉2826进程后，30秒后哨兵的控制台输出：</p>
<p>2989:X 05 Jun 20:09:33.509 # +sdown slave 127.0.0.1:6380 127.0.0.1 6380 @ taotaoMaster 127.0.0.1 6379</p>
<p>说明已经监控到slave宕机了，那么，如果我们将3380端口的redis实例启动后，会自动加入到主从复制吗？</p>
<p>2989:X 05 Jun 20:13:22.716 * +reboot slave 127.0.0.1:6380 127.0.0.1 6380 @ taotaoMaster 127.0.0.1 6379<br>
2989:X 05 Jun 20:13:22.788 # -sdown slave 127.0.0.1:6380 127.0.0.1 6380 @ taotaoMaster 127.0.0.1 6379</p>
<p>可以看出，slave从新加入到了主从复制中。-sdown：说明是恢复服务。</p>
<p>3.6.主库宕机<br>
哨兵控制台打印出如下信息：</p>
<p>2989:X 05 Jun 20:16:50.300 # +sdown master taotaoMaster 127.0.0.1 6379  说明master服务已经宕机<br>
2989:X 05 Jun 20:16:50.300 # +odown master taotaoMaster 127.0.0.1 6379 #quorum 1/1<br>
2989:X 05 Jun 20:16:50.300 # +new-epoch 1<br>
2989:X 05 Jun 20:16:50.300 # +try-failover master taotaoMaster 127.0.0.1 6379  开始恢复故障<br>
2989:X 05 Jun 20:16:50.304 # +vote-for-leader 9059917216012421e8e89a4aa02f15b75346d2b7 1  投票选举哨兵leader，现在就一个哨兵所以leader就自己<br>
2989:X 05 Jun 20:16:50.304 # +elected-leader master taotaoMaster 127.0.0.1 6379  选中leader<br>
2989:X 05 Jun 20:16:50.304 # +failover-state-select-slave master taotaoMaster 127.0.0.1 6379 选中其中的一个slave当做master<br>
2989:X 05 Jun 20:16:50.357 # +selected-slave slave 127.0.0.1:6381 127.0.0.1 6381 @ taotaoMaster 127.0.0.1 6379  选中6381<br>
2989:X 05 Jun 20:16:50.357 <em> +failover-state-send-slaveof-noone slave 127.0.0.1:6381 127.0.0.1 6381 @ taotaoMaster 127.0.0.1 6379  发送slaveof no one命令<br>
2989:X 05 Jun 20:16:50.420 </em> +failover-state-wait-promotion slave 127.0.0.1:6381 127.0.0.1 6381 @ taotaoMaster 127.0.0.1 6379   等待升级master<br>
2989:X 05 Jun 20:16:50.515 # +promoted-slave slave 127.0.0.1:6381 127.0.0.1 6381 @ taotaoMaster 127.0.0.1 6379  升级6381为master<br>
2989:X 05 Jun 20:16:50.515 # +failover-state-reconf-slaves master taotaoMaster 127.0.0.1 6379<br>
2989:X 05 Jun 20:16:50.566 <em> +slave-reconf-sent slave 127.0.0.1:6380 127.0.0.1 6380 @ taotaoMaster 127.0.0.1 6379<br>
2989:X 05 Jun 20:16:51.333 </em> +slave-reconf-inprog slave 127.0.0.1:6380 127.0.0.1 6380 @ taotaoMaster 127.0.0.1 6379<br>
2989:X 05 Jun 20:16:52.382 <em> +slave-reconf-done slave 127.0.0.1:6380 127.0.0.1 6380 @ taotaoMaster 127.0.0.1 6379<br>
2989:X 05 Jun 20:16:52.438 # +failover-end master taotaoMaster 127.0.0.1 6379 故障恢复完成<br>
2989:X 05 Jun 20:16:52.438 # +switch-master taotaoMaster 127.0.0.1 6379 127.0.0.1 6381  主数据库从6379转变为6381<br>
2989:X 05 Jun 20:16:52.438 </em> +slave slave 127.0.0.1:6380 127.0.0.1 6380 @ taotaoMaster 127.0.0.1 6381  添加6380为6381的从库<br>
2989:X 05 Jun 20:16:52.438 * +slave slave 127.0.0.1:6379 127.0.0.1 6379 @ taotaoMaster 127.0.0.1 6381  添加6379为6381的从库<br>
2989:X 05 Jun 20:17:22.463 # +sdown slave 127.0.0.1:6379 127.0.0.1 6379 @ taotaoMaster 127.0.0.1 6381 发现6379已经宕机，等待6379的恢复</p>
<p>可以看出，目前，6381位master，拥有一个slave为6380.</p>
<p>接下来，我们恢复6379查看状态：<br>
2989:X 05 Jun 20:35:32.172 # -sdown slave 127.0.0.1:6379 127.0.0.1 6379 @ taotaoMaster 127.0.0.1 6381  6379已经恢复服务<br>
2989:X 05 Jun 20:35:42.137 * +convert-to-slave slave 127.0.0.1:6379 127.0.0.1 6379 @ taotaoMaster 127.0.0.1 6381  将6379设置为6381的slave</p>
<p>3.7.配置多个哨兵<br>
vim sentinel.conf<br>
输入内容：<br>
sentinel monitor taotaoMaster 127.0.0.1 6381 2<br>
sentinel monitor taotaoMaster2 127.0.0.1 6381 1</p>
<p>3451:X 05 Jun 21:05:56.083 # +sdown master taotaoMaster2 127.0.0.1 6381<br>
3451:X 05 Jun 21:05:56.083 # +odown master taotaoMaster2 127.0.0.1 6381 #quorum 1/1<br>
3451:X 05 Jun 21:05:56.083 # +new-epoch 1<br>
3451:X 05 Jun 21:05:56.083 # +try-failover master taotaoMaster2 127.0.0.1 6381<br>
3451:X 05 Jun 21:05:56.086 # +vote-for-leader 3f020a35c9878a12d2b44904f570dc0d4015c2ba 1<br>
3451:X 05 Jun 21:05:56.086 # +elected-leader master taotaoMaster2 127.0.0.1 6381<br>
3451:X 05 Jun 21:05:56.086 # +failover-state-select-slave master taotaoMaster2 127.0.0.1 6381<br>
3451:X 05 Jun 21:05:56.087 # +sdown master taotaoMaster 127.0.0.1 6381<br>
3451:X 05 Jun 21:05:56.189 # +selected-slave slave 127.0.0.1:6380 127.0.0.1 6380 @ taotaoMaster2 127.0.0.1 6381<br>
3451:X 05 Jun 21:05:56.189 <em> +failover-state-send-slaveof-noone slave 127.0.0.1:6380 127.0.0.1 6380 @ taotaoMaster2 127.0.0.1 6381<br>
3451:X 05 Jun 21:05:56.252 </em> +failover-state-wait-promotion slave 127.0.0.1:6380 127.0.0.1 6380 @ taotaoMaster2 127.0.0.1 6381<br>
3451:X 05 Jun 21:05:57.145 # +promoted-slave slave 127.0.0.1:6380 127.0.0.1 6380 @ taotaoMaster2 127.0.0.1 6381<br>
3451:X 05 Jun 21:05:57.145 # +failover-state-reconf-slaves master taotaoMaster2 127.0.0.1 6381<br>
3451:X 05 Jun 21:05:57.234 <em> +slave-reconf-sent slave 127.0.0.1:6379 127.0.0.1 6379 @ taotaoMaster2 127.0.0.1 6381<br>
3451:X 05 Jun 21:05:58.149 </em> +slave-reconf-inprog slave 127.0.0.1:6379 127.0.0.1 6379 @ taotaoMaster2 127.0.0.1 6381<br>
3451:X 05 Jun 21:05:58.149 <em> +slave-reconf-done slave 127.0.0.1:6379 127.0.0.1 6379 @ taotaoMaster2 127.0.0.1 6381<br>
3451:X 05 Jun 21:05:58.203 # +failover-end master taotaoMaster2 127.0.0.1 6381<br>
3451:X 05 Jun 21:05:58.203 # +switch-master taotaoMaster2 127.0.0.1 6381 127.0.0.1 6380<br>
3451:X 05 Jun 21:05:58.203 </em> +slave slave 127.0.0.1:6379 127.0.0.1 6379 @ taotaoMaster2 127.0.0.1 6380<br>
3451:X 05 Jun 21:05:58.203 * +slave slave 127.0.0.1:6381 127.0.0.1 6381 @ taotaoMaster2 127.0.0.1 6380<br>
4.集群<br>
即使有了主从复制，每个数据库都要保存整个集群中的所有数据，容易形成木桶效应。</p>
<p>使用Jedis实现了分片集群，是由客户端控制哪些key数据保存到哪个数据库中，如果在水平扩容时就必须手动进行数据迁移，而且需要将整个集群停止服务，这样做非常不好的。</p>
<p>Redis3.0版本的一大特性就是集群（Cluster），接下来我们一起学习集群。<br>
4.1.架构</p>
<p>(1)所有的redis节点彼此互联(PING-PONG机制),内部使用二进制协议优化传输速度和带宽.<br>
(2)节点的fail是通过集群中超过半数的节点检测失效时才生效.<br>
(3)客户端与redis节点直连,不需要中间proxy层.客户端不需要连接集群所有节点,连接集群中任何一个可用节点即可<br>
(4)redis-cluster把所有的物理节点映射到[0-16383]slot（插槽）上,cluster 负责维护node&lt;-&gt;slot&lt;-&gt;value<br>
4.2.修改配置文件<br>
1、设置不同的端口，6379、6380、6381<br>
2、开启集群，cluster-enabled yes<br>
3、指定集群的配置文件，cluster-config-file "nodes-xxxx.conf"</p>
<p>4.3.创建集群<br>
4.3.1.安装ruby环境<br>
因为redis-trib.rb是有ruby语言编写的所以需要安装ruby环境。</p>
<p>yum -y install zlib ruby rubygems<br>
gem install redis</p>
<p>手动安装：<br>
rz上传redis-3.2.1.gem<br>
gem install -l redis-3.2.1.gem<br>
4.3.2.创建集群<br>
首先，进入redis的安装包路径下：<br>
cd /usr/local/src/redis/redis-3.0.1/src/</p>
<p>执行命令：<br>
./redis-trib.rb create --replicas 0 192.168.56.102:6379 192.168.56.102:6380 192.168.56.102:6381</p>
<p>--replicas 0：指定了从数据的数量为0</p>
<p>注意：这里不能使用127.0.0.1，否则在Jedis客户端使用时无法连接到！</p>
<p>redis-trib用法：</p>
<p>4.3.3.测试</p>
<p>什么情况？？(error) MOVED 7638 127.0.0.1:6380  </p>
<p>因为abc的hash槽信息是在6380上，现在使用redis-cli连接的6379，无法完成set操作，需要客户端跟踪重定向。</p>
<p>redis-cli -c</p>
<p>看到由6379跳转到了6380，然后再进入6379看能否get到数据</p>
<p>还是被重定向到了6380，不过已经可以获取到数据了。<br>
4.4.使用Jedis连接到集群<br>
添加依赖，要注意jedis的版本为2.7.2</p>
<p>说明：这里的jc不需要关闭，因为内部已经关闭连接了。<br>
4.5.插槽的分配<br>
通过cluster nodes命令可以查看当前集群的信息：</p>
<p>该信息反映出了集群中的每个节点的id、身份、连接数、插槽数等。</p>
<p>当我们执行set abc 123命令时，redis是如何将数据保存到集群中的呢？执行步骤：<br>
1、接收命令set abc 123<br>
2、通过key（abc）计算出插槽值，然后根据插槽值找到对应的节点。（abc的插槽值为：7638）<br>
3、重定向到该节点执行命令</p>
<p>整个Redis提供了16384个插槽，也就是说集群中的每个节点分得的插槽数总和为16384。<br>
./redis-trib.rb 脚本实现了是将16384个插槽平均分配给了N个节点。</p>
<p>注意：如果插槽数有部分是没有指定到节点的，那么这部分插槽所对应的key将不能使用。<br>
4.6.插槽和key的关系<br>
计算key的插槽值：<br>
key的有效部分使用CRC16算法计算出哈希值，再将哈希值对16384取余，得到插槽值。</p>
<p>什么是有效部分？<br>
1、如果key中包含了{符号，且在{符号后存在}符号，并且{和}之间至少有一个字符，则有效部分是指{和}之间的部分；<br>
a)key={hello}_tatao的有效部分是hello<br>
2、如果不满足上一条情况，整个key都是有效部分；<br>
a)key=hello_taotao的有效部分是全部<br>
4.7.新增集群节点<br>
再开启一个实例的端口为6382</p>
<p>执行脚本：<br>
./redis-trib.rb add-node 192.168.56.102:6382 192.168.56.102:6379</p>
<p>已经添加成功！查看集群信息：</p>
<p>发现没有插槽数。</p>
<p>接下来需要给6382这个服务分配插槽，将6379的一部分（1000个）插槽分配给6382：</p>
<p>查看节点情况：</p>
<p>4.8.删除集群节点<br>
想要删除集群节点中的某一个节点，需要严格执行2步：<br>
1、将这个节点上的所有插槽转移到其他节点上；<br>
a)假设我们想要删除6380这个节点<br>
b)执行脚本：./redis-trib.rb reshard 192.168.56.102:6380<br>
c)选择需要转移的插槽的数量，因为3380有5128个，所以转移5128个</p>
<p>d)输入转移的节点的id，我们转移到6382节点：82ed0d63cfa6d19956dca833930977a87d6ddf7<br>
e)输入插槽来源id，也就是6380的id<br>
f)输入done，开始转移</p>
<p>g)查看集群信息，可以看到6380节点已经没有插槽了。</p>
<p>2、使用redis-trib.rb删除节点<br>
a)./redis-trib.rb del-node 192.168.56.102:6380 4a9b8886ba5261e82597f5590fcdb49ea47c4c6c<br>
b)del-node host:port node_id<br>
c)<br>
d)查看集群信息，可以看到已经没有6380这个节点了。</p>
<p>4.9.故障转移<br>
如果集群中的某一节点宕机会出现什么状况？我们这里假设6381宕机。</p>
<p>我们尝试连接下集群，并且查看集群信息，发现6381的节点断开连接：</p>
<p>我们尝试执行set命令，结果发现无法执行：</p>
<p>什么情况？集群不可用了？？ 这集群也太弱了吧？？<br>
4.9.1.故障机制<br>
1、集群中的每个节点都会定期的向其它节点发送PING命令，并且通过有没有收到回复判断目标节点是否下线；<br>
2、集群中每一秒就会随机选择5个节点，然后选择其中最久没有响应的节点放PING命令；<br>
3、如果一定时间内目标节点都没有响应，那么该节点就认为目标节点疑似下线；<br>
4、当集群中的节点超过半数认为该目标节点疑似下线，那么该节点就会被标记为下线；<br>
5、当集群中的任何一个节点下线，就会导致插槽区有空档，不完整，那么该集群将不可用；<br>
6、如何解决上述问题？<br>
a)在Redis集群中可以使用主从模式实现某一个节点的高可用<br>
b)当该节点（master）宕机后，集群会将该节点的从数据库（slave）转变为（master）继续完成集群服务；<br>
4.9.2.集群中的主从复制架构<br>
架构：</p>
<p>出现故障：</p>
<p>4.9.3.创建主从集群<br>
需要启动6个redis实例，分别是：<br>
6379（主） 6479（从）<br>
6380（主） 6480（从）<br>
6381（主） 6481（从）</p>
<p>启动redis实例：<br>
cd 6379/ &amp;&amp; redis-server ./redis.conf &amp;&amp; cd ..<br>
cd 6380/ &amp;&amp; redis-server ./redis.conf &amp;&amp; cd ..<br>
cd 6381/ &amp;&amp; redis-server ./redis.conf &amp;&amp; cd ..<br>
cd 6479/ &amp;&amp; redis-server ./redis.conf &amp;&amp; cd ..<br>
cd 6480/ &amp;&amp; redis-server ./redis.conf &amp;&amp; cd ..<br>
cd 6481/ &amp;&amp; redis-server ./redis.conf &amp;&amp; cd ..</p>
<p>创建集群，指定了从库数量为1，创建顺序为主库（3个）、从库（3个）：<br>
./redis-trib.rb create --replicas 1 192.168.56.102:6379 192.168.56.102:6380 192.168.56.102:6381 192.168.56.102:6479 192.168.56.102:6480 192.168.56.102:6481</p>
<p>创建成功！查看集群信息：</p>
<p>4.9.4.测试</p>
<p>保存、读取数据OK！</p>
<p>查看下6480的从库数据：</p>
<p>看到从6480查看数据也是被重定向到6380.</p>
<p>说明集群一切运行OK！<br>
4.9.5.测试集群中slave节点宕机<br>
我们将6480节点kill掉，查看情况。</p>
<p>查看集群情况：</p>
<p>发现6480节点不可用。</p>
<p>那么整个集群可用吗？</p>
<p>发现集群可用，可见从数据库宕机不会影响集群正常服务。</p>
<p>恢复6480服务：</p>
<p>测试6480中的数据：</p>
<p>看到已经更新成最新数据。<br>
4.9.6.测试集群中master宕机<br>
假设6381宕机：</p>
<p>查看集群情况：</p>
<p>发现：<br>
1、6381节点失效不可用<br>
2、6481节点从slave转换为master</p>
<p>测试集群是否可用：</p>
<p>集群可用。</p>
<p>恢复6381：</p>
<p>发现：<br>
1、6381节点可用<br>
2、6481依然是主节点<br>
3、6381成为6481的从数据库<br>
4.10.使用集群需要注意的事项<br>
1、多键的命令操作（如MGET、MSET），如果每个键都位于同一个节点，则可以正常支持，否则会提示错误。<br>
2、集群中的节点只能使用0号数据库，如果执行SELECT切换数据库会提示错误。</p>
        </div>
                <!-- 标签 -->
        
                <div class="cat-box">
            <div class="cat-wrap clearfix">
                <span class="l">相关标签：</span>
                                                <a class="cat l" href="http://www.imooc.com/article/tag/3" target="_blank">JAVA</a>
                                                <a class="cat l" href="http://www.imooc.com/article/tag/20" target="_blank">Linux</a>
                                                <a class="cat l" href="http://www.imooc.com/article/tag/35" target="_blank">大数据</a>
                            </div>
        </div>
            
        <!-- 推荐 --> 
                <div class="praise-box">
            <button id="js-praise"><span class="icon-thumb_o"></span><div style="position: absolute; top: 50%; left: 50%; width: 230px; height: 230px; margin-left: -115px; margin-top: -115px; opacity: 0.6; display: none; transform: rotate(0deg) translate(0px, 0px);"><svg style="position: absolute; width: 100%; height: 100%;"><ellipse cy="0" cx="0" ry="15" rx="15" transform="rotate(0,0,0)" fill-opacity="1" stroke-linecap="" stroke-dashoffset="NaN " fill="#F9B552" stroke-dasharray="NaN " stroke-opacity="1" stroke-width="0" stroke="transparent" style="opacity: 1; display: none;"></ellipse><ellipse cy="0" cx="0" ry="15" rx="15" transform="rotate(0,0,0)" fill-opacity="1" stroke-linecap="" stroke-dashoffset="NaN " fill="#F9B552" stroke-dasharray="NaN " stroke-opacity="1" stroke-width="0" stroke="transparent" style="opacity: 1; display: none;"></ellipse><ellipse cy="0" cx="0" ry="15" rx="15" transform="rotate(0,0,0)" fill-opacity="1" stroke-linecap="" stroke-dashoffset="NaN " fill="#F9B552" stroke-dasharray="NaN " stroke-opacity="1" stroke-width="0" stroke="transparent" style="opacity: 1; display: none;"></ellipse><ellipse cy="0" cx="0" ry="15" rx="15" transform="rotate(0,0,0)" fill-opacity="1" stroke-linecap="" stroke-dashoffset="NaN " fill="#F9B552" stroke-dasharray="NaN " stroke-opacity="1" stroke-width="0" stroke="transparent" style="opacity: 1; display: none;"></ellipse><ellipse cy="0" cx="0" ry="15" rx="15" transform="rotate(0,0,0)" fill-opacity="1" stroke-linecap="" stroke-dashoffset="NaN " fill="#F9B552" stroke-dasharray="NaN " stroke-opacity="1" stroke-width="0" stroke="transparent" style="opacity: 1; display: none;"></ellipse><ellipse cy="0" cx="0" ry="15" rx="15" transform="rotate(0,0,0)" fill-opacity="1" stroke-linecap="" stroke-dashoffset="NaN " fill="#F9B552" stroke-dasharray="NaN " stroke-opacity="1" stroke-width="0" stroke="transparent" style="opacity: 1; display: none;"></ellipse></svg></div><div style="position: absolute; top: 50%; left: 50%; width: 180px; height: 180px; margin-left: -90px; margin-top: -90px; opacity: 0.6; display: none; transform: translate(0px, 0px);"><svg style="position: absolute; width: 100%; height: 100%;"><ellipse cy="90" cx="90" ry="0" rx="0" transform="rotate(0,90,90)" fill-opacity="transparent" stroke-linecap="" stroke-dashoffset="" fill="transparent" stroke-dasharray="" stroke-opacity="1" stroke-width="20" stroke="#F9B552"></ellipse></svg></div></button>
        </div>
                
        <div class="show-praise-wrap">
            <div class="show-praise-user clearfix">
                <div class="praise-icon l">
                    <ul id="js-praise-show" class="clearfix">
                    <li class="l"><a target="_blank" href="http://www.imooc.com/u/1231828/articles">                                                <img src="./绝对干货-Redis集群的优化_慕课手记_files/545861e40001199702200220-100-100.jpg" title="奋斗IT">                                                </a></li><li class="l"><a target="_blank" href="http://www.imooc.com/u/1970106/articles">                                                <img src="./绝对干货-Redis集群的优化_慕课手记_files/55596418000101d901800180-100-100.jpg" title="weibo_JJ小卫西_0">                                                </a></li><li class="l"><a target="_blank" href="http://www.imooc.com/u/2516424/articles">                                                <img src="./绝对干货-Redis集群的优化_慕课手记_files/5632fcca00018b8701000100-100-100.jpg" title="qq_听说_6">                                                </a></li><li class="l"><a target="_blank" href="http://www.imooc.com/u/2750587/articles">                                                <img src="./绝对干货-Redis集群的优化_慕课手记_files/567ec6ae0001262101800180-100-100.jpg" title="连宏伟HW">                                                </a></li><li class="l"><a target="_blank" href="http://www.imooc.com/u/3038658/articles">                                                <img src="./绝对干货-Redis集群的优化_慕课手记_files/56e616640001fc1c01000100-100-100.jpg" title="qq_活在梦上_0">                                                </a></li><li class="l"><a target="_blank" href="http://www.imooc.com/u/3732264/articles">                                                <img src="./绝对干货-Redis集群的优化_慕课手记_files/533e4d7c0001828702000200-100-100.jpg" title="忘我00">                                                </a></li></ul>
                </div>

                <div class="praise-num l">
                    <span class="num">6</span>
                    <span class="person">人</span>推荐
                </div>
            </div>
        </div>
        
        <!-- 推荐end -->

        <!-- 分享&收藏 -->
        <div class="active-box clearfix">
            <div class="share-collect-wrap clearfix">
                <div class="share-box l">
                    <!-- 分享 -->
                    <div class="share-rl-tips share-posi js-share-statue l" style="display: none;">
                        <span>分享即可 +</span><strong>1积分</strong>
                        <span class="rule-arrow"></span>
                    </div>
                    <div class="small-share l">
                        <ul class="share-wrap">
                            <li class="weichat-posi">
                                <div class="bdsharebuttonbox weichat-style bdshare-button-style0-16" data-bd-bind="1493292519673">
                                    <a href="http://www.imooc.com/article/14592#" class="bds_weixin icon-nav icon-share-weichat" data-cmd="weixin" title="分享到微信"></a>
                                    <a href="http://www.imooc.com/article/14592#" class="bds_tsina icon-nav icon-share-weibo" data-cmd="tsina" title="分享到新浪微博"></a>
                                    <a href="http://www.imooc.com/article/14592#" class="bds_qzone icon-nav icon-share-qq" data-cmd="qzone" title="分享到QQ空间"></a>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <!-- 分享end -->
                <!-- 收藏&举报 -->
                <div class="r-box r">
                                                            <span id="js-follow" data-id="14592" class="dc-follow l">
                            <span>收藏</span>
                        </span>
                                                    </div>
                <!-- 收藏&举报end -->
            </div>
        </div>
        <!-- 分享&收藏 end -->
    </div>
    <!-- 手记详情end -->
  
    <!-- 相关阅读 -->
    <div class="react-article">
        <h2>相关阅读</h2><ul><li><a href="http://www.imooc.com/article/4260" title="《Redis系列专题》 之 Redis官方集群方案 Redis Cluster"><h3>《Redis系列专题》 之 Redis官方集群方案 Redis Cluster</h3></a></li><li><a href="http://www.imooc.com/article/7799" title="《Docker系列专题》之 描述篇"><h3>《Docker系列专题》之 描述篇</h3></a></li><li><a href="http://www.imooc.com/article/9933" title="xml 解析（DOM）视频总结"><h3>xml 解析（DOM）视频总结</h3></a></li><li><a href="http://www.imooc.com/article/10237" title="CentOS 7下搭建高可用集群"><h3>CentOS 7下搭建高可用集群</h3></a></li><li><a href="http://www.imooc.com/article/10981" title="Java操作Redis之入门拐卖字符串篇"><h3>Java操作Redis之入门拐卖字符串篇</h3></a></li></ul>
    </div>
    <!-- 相关阅读end -->


    <div class="detail-feedback-wrap">
        <!-- 评论框 -->
        <div class="df-ipt-wrap" id="comment">
                    <div class="feeds-author">
                <span><img src="./绝对干货-Redis集群的优化_慕课手记_files/avatar_default.png" width="40" alt=""></span>
            </div>
            <div id="js-text-login" class="df-text df-text-login">
                <textarea class="ipt" readonly="">请登录后，发表评论</textarea>
                <div class="df-bottom clearfix">
                    <button id="js-submit" class="btn btn-green disabled r">评论（Enter+Ctrl）</button>
                </div>
            </div>
                </div>
        <!-- 评论框end -->

        <!-- 热门评论 -->
        <div class="hot-df-title" style="display: none;">热门评论</div>
        <div id="js-feedback-hot-list-wrap" class="feedback-list" style="display: none;">
            <p class="feedback-loading">
            评论加载中...
            </p>
        </div>
        <!-- 评论 -->
        <div class="df-title" id="all_comments">全部评论<span class="comment-num"><i>0</i>条</span></div>
        <div id="js-feedback-list-wrap" class="feedback-list"><p class="feedback-none">暂无评论</p></div>
        <!-- 分页页码  -->
        <div class="qa-comment-page"></div>
    </div>
</div><!-- 左侧end -->

<div class="detail-right r"><!-- 右侧start -->
    <!-- 作者信息 -->
        <div class="aside-author">
        <div class="p clearfix">
            <a href="http://www.imooc.com/u/2533881/articles" class="l" title="Qing勇" target="_blank">
                <img src="./绝对干货-Redis集群的优化_慕课手记_files/56392a7a0001d98106380640-100-100.jpg">
            </a>
        </div>
        <p class="u-nick-warp">
         <a class="nick" href="http://www.imooc.com/u/2533881/articles" title="Qing勇" target="_blank">
            Qing勇
            </a>
                               
                    </p>
       
        <span class="user-job"></span>
        <span class="user-desc">
            这位童鞋很懒，什么也没有留下～～！
        </span>
        <div class="btn-box clearfix">
            <a href="http://www.imooc.com/u/2533881/articles" target="_blank" class="article-num r-bor l">
                <span>13</span>篇手记
            </a>
            <a href="http://www.imooc.com/u/2533881/articles?type=praise" target="_blank" class="article-recom l">
                <span>4</span>推荐
            </a>
        </div>
    </div>
        <!-- 作者信息end -->

    <!-- 作者热门手记 -->
        <div class="other-article">
        <h2>作者的热门手记</h2>
        <ul>
                    <li>
                <a href="http://www.imooc.com/article/14590" title="干货-MySql5.6性能优化"><h3>干货-MySql5.6性能优化</h3></a>
                <div class="show-box clearfix">
                    <span class="spacer l">1511浏览</span>
                    <span class="spacer l spacer-2">24推荐</span>
                    <span class="spacer l" href="">1评论</span>
                </div>
            </li>
                    <li>
                <a href="http://www.imooc.com/article/14693" title="hibernate跟Mybatis/ ibatis 的区别，为什么选择？"><h3>hibernate跟Mybatis/&nbsp;ibatis&nbsp;的区别，为什么选择？</h3></a>
                <div class="show-box clearfix">
                    <span class="spacer l">1301浏览</span>
                    <span class="spacer l spacer-2">11推荐</span>
                    <span class="spacer l" href="">0评论</span>
                </div>
            </li>
                    <li>
                <a href="http://www.imooc.com/article/14110" title="pl/sql存储过程及案例分析"><h3>pl/sql存储过程及案例分析</h3></a>
                <div class="show-box clearfix">
                    <span class="spacer l">589浏览</span>
                    <span class="spacer l spacer-2">7推荐</span>
                    <span class="spacer l" href="">0评论</span>
                </div>
            </li>
                    <li>
                <a href="http://www.imooc.com/article/15138" title="使用HttpClient和Jsoup快捷抓取和分析页面"><h3>使用HttpClient和Jsoup快捷抓取和分析页面</h3></a>
                <div class="show-box clearfix">
                    <span class="spacer l">530浏览</span>
                    <span class="spacer l spacer-2">4推荐</span>
                    <span class="spacer l" href="">1评论</span>
                </div>
            </li>
                    <li>
                <a href="http://www.imooc.com/article/14254" title="谈谈我对Spring 的理解"><h3>谈谈我对Spring 的理解</h3></a>
                <div class="show-box clearfix">
                    <span class="spacer l">586浏览</span>
                    <span class="spacer l spacer-2">4推荐</span>
                    <span class="spacer l" href="">0评论</span>
                </div>
            </li>
                </ul>
    </div>
        <!-- 作者热门手记end -->

    <!-- 广告 -->
                    <!-- 广告end -->
  
</div><!-- 右侧end -->

<!-- 手记目录 -->
<div id="article_directory" class="article_directory r">
    <h2>手记目录</h2>
    <ul class="dire-list">
            <li class="dire">
            <a href="http://www.imooc.com/article/14592#parent_1" class="dire-title level1 title-link">修改如下，默认为no</a>
        </li>
                    <li class="dire">
            <a href="http://www.imooc.com/article/14592#parent_2" class="dire-title level1 title-link">启动</a>
        </li>
                    <li class="dire">
            <a href="http://www.imooc.com/article/14592#parent_3" class="dire-title level1 title-link">测试</a>
        </li>
                </ul>
</div>
<!-- 手记目录end -->


</div><!--opus-wrap end-->

<div id="main">

</div>

<div id="footer">
    <div class="waper">
        <div class="footerwaper clearfix">
            <div class="followus r">
                <a class="followus-weixin" href="javascript:;" target="_blank" title="微信">
                    <div class="flw-weixin-box"></div>
                </a>
                <a class="followus-weibo" href="http://weibo.com/u/3306361973" target="_blank" title="新浪微博"></a>
                <a class="followus-qzone" href="http://user.qzone.qq.com/1059809142/" target="_blank" title="QQ空间"></a>
            </div>
            <div class="footer_intro l">
                <div class="footer_link">
                    <ul>
                        <li><a href="http://www.imooc.com/" target="_blank">网站首页</a></li>
                        <li><a href="http://www.imooc.com/about/cooperate" target="_blank" title="企业合作">企业合作</a></li>
                        <li><a href="http://www.imooc.com/about/job" target="_blank">人才招聘</a></li>
                        <li> <a href="http://www.imooc.com/about/contact" target="_blank">联系我们</a></li>
                        <li> <a href="http://www.imooc.com/about/recruit" target="_blank">讲师招募</a></li>
                        <li> <a href="http://www.imooc.com/about/faq" target="_blank">常见问题</a></li>
                        <li> <a href="http://www.imooc.com/user/feedback" target="_blank">意见反馈</a></li>
                        <li><a href="http://daxue.imooc.com/" target="_blank">慕课大学</a></li>
                        <li> <a href="http://www.imooc.com/about/friendly" target="_blank">友情链接</a></li>
                       <!--  <li><a href="/corp/index" target="_blank">合作专区</a></li>
                        <li><a href="/about/us" target="_blank">关于我们</a></li> -->
                    </ul>
                </div>
                <p>Copyright © 2017 imooc.com All Rights Reserved | 京ICP备 13046642号-2</p>
            </div>
        </div>
    </div>
</div>


<div id="J_GotoTop" class="elevator">

    <a href="http://www.imooc.com/user/feedback" class="elevator-msg" target="_blank">
        <i class="icon-feedback"></i>
        <span class="">意见反馈</span>
    </a>
    <a href="http://www.imooc.com/about/faq" class="elevator-faq" target="_blank">
        <i class="icon-ques"></i>
        <span class="">常见问题</span>
    </a>
    <a href="http://www.imooc.com/mobile/app" target="_blank" class="elevator-app">
        <i class="icon-appdownload"></i>
        <span class="">APP下载</span>
        <div class="elevator-app-box"></div>
    </a>
    <a href="javascript:void(0)" class="elevator-weixin no-goto" id="js-elevator-weixin">
        <i class="icon-wxgzh"></i>
        <span class="">官方微信</span>
        <div class="elevator-weixin-box"></div>
    </a>
    <a href="javascript:void(0)" class="elevator-top no-goto" style="display:none" id="backTop">
        <i class="icon-up2"></i>
        <span class="">返回顶部</span>
    </a>
</div>



<script type="text/javascript" charset="utf-8" src="./绝对干货-Redis集群的优化_慕课手记_files/ueditor.final.min.js.下载"></script>

<!--script-->
<script src="./绝对干货-Redis集群的优化_慕课手记_files/ssologin.js.下载"></script>
<script type="text/javascript" src="./绝对干货-Redis集群的优化_慕课手记_files/sea.js.下载"></script>
<script type="text/javascript" src="./绝对干货-Redis集群的优化_慕课手记_files/sea_config.js.下载"></script>
<script type="text/javascript">seajs.use("/static/page/"+OP_CONFIG.module+"/"+OP_CONFIG.page);</script>




<div style="display: none">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Ff0cfcccd7b1393990c78efdeebff3968' type='text/javascript'%3E%3C/script%3E"));
(function (d) {
window.bd_cpro_rtid="rHT4P1c";
var s = d.createElement("script");s.type = "text/javascript";s.async = true;s.src = location.protocol + "//cpro.baidu.com/cpro/ui/rt.js";
var s0 = d.getElementsByTagName("script")[0];s0.parentNode.insertBefore(s, s0);
})(document);
</script><script src="./绝对干货-Redis集群的优化_慕课手记_files/h.js.下载" type="text/javascript"></script>
<script>
(function(){
    var bp = document.createElement('script');
    bp.src = '//push.zhanzhang.baidu.com/push.js';
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
</div><script type="text/javascript" src="./绝对干货-Redis集群的优化_慕课手记_files/user"></script><script type="text/javascript" src="./绝对干货-Redis集群的优化_慕课手记_files/iplookup.php"></script><div class="moco-usercard-dialog js-moco-usercard-modal"></div><div></div><div style="position: absolute; top: 100px; left: 100px; width: 164px; height: 164px; margin-left: -82px; margin-top: -82px; opacity: 1; display: none; transform: rotate(0deg) translate(0px, 0px);"><svg style="position: absolute; width: 100%; height: 100%;"><ellipse cy="0" cx="0" ry="7" rx="7" transform="rotate(0,0,0)" fill-opacity="1" stroke-linecap="" stroke-dashoffset="NaN " fill="deeppink" stroke-dasharray="NaN " stroke-opacity="1" stroke-width="0" stroke="transparent" style="opacity: 1; display: none;"></ellipse><ellipse cy="0" cx="0" ry="7" rx="7" transform="rotate(0,0,0)" fill-opacity="1" stroke-linecap="" stroke-dashoffset="NaN " fill="deeppink" stroke-dasharray="NaN " stroke-opacity="1" stroke-width="0" stroke="transparent" style="opacity: 1; display: none;"></ellipse><ellipse cy="0" cx="0" ry="7" rx="7" transform="rotate(0,0,0)" fill-opacity="1" stroke-linecap="" stroke-dashoffset="NaN " fill="deeppink" stroke-dasharray="NaN " stroke-opacity="1" stroke-width="0" stroke="transparent" style="opacity: 1; display: none;"></ellipse><ellipse cy="0" cx="0" ry="7" rx="7" transform="rotate(0,0,0)" fill-opacity="1" stroke-linecap="" stroke-dashoffset="NaN " fill="deeppink" stroke-dasharray="NaN " stroke-opacity="1" stroke-width="0" stroke="transparent" style="opacity: 1; display: none;"></ellipse><ellipse cy="0" cx="0" ry="7" rx="7" transform="rotate(0,0,0)" fill-opacity="1" stroke-linecap="" stroke-dashoffset="NaN " fill="deeppink" stroke-dasharray="NaN " stroke-opacity="1" stroke-width="0" stroke="transparent" style="opacity: 1; display: none;"></ellipse></svg></div>


</body></html>