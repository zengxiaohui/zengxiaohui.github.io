'use strict';

import Base from './base.js';
import UserMgr from '../connect/usermgr.js';
import BizMgr from '../connect/bizmgr.js';

var mgr = new UserMgr();
//-------------------------------
var mgm = new BizMgr();

export default class extends Base {

	async indexAction(){
	 	return this.display();
	 }



	 async  downloadAction(){
	 		try{

	 			let orderId = this.get("orderId");

	 			console.log(orderId);
	 			let userId = this.cookie("userId");
	 		
	 			let pm = await mgm.downLoadPill(userId,orderId)
	 			.then(function(result){

	 				console.log(result);
	 				return result;
	 			},function(error){

	 			})
	 			let pillinfor = pm.receipt;
	 			console.log(typeof pillinfor);
	 			var pillinfor1 = JSON.parse(pillinfor);
	 			console.log(typeof pillinfor1);

	 			console.log(pillinfor1[0].fphm);
	 			//var pillinfor2 =JSON.stringify(pillinfor1);
	 			//console.log(pillinfor[2]);


	 			
	 		


	 		}catch(e){

	 		}
	 		console.log(pillinfor1[0].fphm);
	 		//var filename = 'user.js';
	 			
	 			//var address = 'C://Users//Administrator//Desktop//test//';
	 			//var address = 'C://Users//Administrator//Desktop//fdmweb22//fdmweb//src//home//controller//'
	 			var filename =  pillinfor1[0].fphm+ '_个人.pdf'
	 			//var filename = '11.txt' ;
	 			//var address = '//fp//'
	 			//var address = '/fp/'
	 		var __filename = address+filename;
	 		let filePath = __filename;

	 	this.download(filePath);
	 		
	 		
	 }

	 async downloadpillAction(){
	 		
	 }
	 async queryAction(){


	 	try{
	 		let userId = this.cookie("userId");
	 		console.log("========queryAction============");
	 		console.log(userId)
	 		let pm = await mgm.queryOrder(userId)
	 		.then(function(result){

	 			console.log(result);
	 			return result;
	 		},function(error){
	 			console.log(error);
	 		})

	 		//console.log(pm);
	 		//console.log(pm.testList);
	 		this.assign("pm",pm);
	 		//for(let j in pm){
      //var elm = pm.testList;
     // console.log(elm.userId + "|" + elm.name + "|" + elm.password); 
     // this.assign('elm',elm);
      	console.log(pm.testList);
      	console.log(pm.testList.length);
      	if(pm.testList.length==undefined){
      		this.assign('testList1',pm.testList);

      	}else{
      		this.assign('testList',pm.testList);
      	}
     
      //this.assign('testList',pm.testList.phoneNumber);
   // }
	 		//this.assign("pm",pm);

	 	}catch(e){

	 	}


	 	return this.display();
	 }


	 async billAction(){
	 	console.log("=====billAction=========");
	 	var infor = this.get();


	 	console.log(infor.testItem);
	 	var testItem = infor.testItem;
	 	var aa  = testItem.split(",");
	 	console.log(aa);
	 	console.log(aa.length);
	 	var testItemName=["FD-Tissue-180","FD-ctDNA-180","FD-Tissue-600","FD-ctDNA-600","FD-Exome","FD-ctDNA-Exome",
	 	"FD-Tissue-RNA","FD-Tissue-180+FD-ctDNA-180","FD-Tissue-600+FD-ctDNA-600"]
	 	this.assign('itemName1',testItemName[aa[0]-1]);
	 	this.assign('itemName1Num',aa[1]);
	 	this.assign('itemName2',testItemName[aa[2]-1]);
	 	this.assign('itemName2Num',aa[3]);
	 	this.assign('itemName3',testItemName[aa[4]-1]);
	 	this.assign('itemName3Num',aa[5]);
	 	console.log(aa[0]);
	 	console.log(testItemName[aa[0]-1]);
	 	console.log(aa[1]);
	 	console.log(testItemName[aa[2]-1]);
	 	console.log(aa[3]);
	 	console.log(testItemName[aa[4]-1]);
	 	console.log(aa[5]);

	 	this.assign("inforbill",infor);
	 	var  sendDate = infor.sendDate;
  			

   		var sendDate1 = sendDate.substring(0,10);

   		this.assign("sendDate1",sendDate1);
   		

	 	return this.display();

	 }
}